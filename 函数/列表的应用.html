<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title></title>
	</head>

	<body>

		<script type="text/javascript">
			function list() {
				this.listsize = 0; //列表的元素个数(属性)
				this.pos = 0; //(属性)列表的当前位置
				this.datastore = []; //初始化一个空数组来保存列表的元素
				this.clear = clear; //清空列表中的所有元素
				this.find = find;
				this.toString = toString; //返回列表的字符串形式
				this.insert = insert; //在现有元素后插入新元素
				this.append = append; //在列表的末尾添加新元素
				this.remove = remove; //从列表中删除元素
				this.front = front; //将列表的当前位置设移动到第一个元素
				this.end = end; //将列表的当前位置移动到最后一个元素
				this.prev = prev; //将当前位置后移一位
				this.next = next; //将当前位置前移一位
				this.length = length; //返回列表中元素的个数
				this.currpos = currpos; //返回列表的当前位置
				this.moveto = moveto; //将当前位置移动到指定位置
				this.getElement = getElement; //返回当前位置的元素
				this.contains = contains; //判断给定值是否在列表中
			}
			//append:给列表添加元素,当新元素就位后，变量 listSize 加 1。
			function append(element) {
				this.datastore[this.listsize++] = element;
			}
			//remove:从列表中删除元素,find:在列表中查找某一元素,该方法用于查找要删除的元素:
			function find(element) {
				for(var i = 0; i < this.datastore.length; ++i) {
					if(this.datastore[i] == element) {
						return i;
					}
				}
				return -1;
			}
			//remove() 方法使用 find() 方法返回的位置对数组 dataStore 进行截取。数组改变后，将变 量 listSize 的值减 1，以反映列表的最新长度。
			function remove(element) {
				var foundAt = this.find(element);
				if(foundAt > -1) {
					this.datastore.splice(foundAt, 1);
					--this.listsize;
					return false;
				}
				return false;
			}

			function length() {
				return this.listsize;
			}

			//toString:显示列表中的元素
			function toString() {
				return this.datastore;
			}

			function insert(element, after) {
				var insertpos = this.find(after);
				if(insertpos > -1) {
					this.datastore.splice(insertpos + 1, 0, element);
					++this.listsize;
					return true;
				}
				return false;
			}
			//insert() 方法用到了 find() 方法，find() 方法会寻找传入的 after 参数在列 表中的位置，找到该位置后，使用 splice() 方法将新元素插入该位置之后，然后将变量 listSize 加 1 并返回 true，表明插入成功。

			function clear() {
				delete this.datastore;
				this.datastore = [];
				this.listsize = this.pos = 0;
			}
			//clear() 方法使用 delete 操作符删除数组 dataStore，接着在下一行创建一个空数组。最后一行将 listSize 和 pos 的值设为 1，表明这是一个新的空列表。

			function contains(element) {
				for(var i = 0; i < this.datastore.length; ++i) {
					if(this.datastore[i] == element) {
						return true;
					}
				}
				return false;
			}
			//遍历列表
			//最后的一组方法允许用户在列表上自由移动，最后一个方法 getElement() 返回列表的当前元素:
			function front() {
				this.pos = 0;
			}

			function end() {
				this.pos = this.listsize - 1;
			}

			function prev() {
				if(this.pos > 0) {
					--this.pos;
				}
			}

			function next() {
				if(this.pos < this.listsize - 1) {
					++this.pos;
				}
			}

			function currpos() {
				return this.pos;
			}

			function moveto(position) {
				this.pos = position;
			}

			function getElement() {
				return this.datastore[this.pos];
			}

			var movies = read(flims.txt).split('\n');
			//使用 trim() 方法删除每个数组元素末尾的空格,从文件中读入数据，然后将结 果保存到一个数组中:
			function createArr(file) {
				var arr = read(file).split('\n');
				for(var i = 0; i < arr.length; ++i) {
					arr[i] = arr[i].trim();
				}
				return arr;
			}
			//将数组 movies 中的元素保存到一个列表中
			var movielist = new list();
			for(var i = 0; i < movies.length; ++i) {
				movielist.append(movies[i]);
			}
			/*
			function displays(list) {
				for(list.front();list.currpos()<list.length;list.next()){
					console.log(list.getElement());
				}
			}
			*/
			//displays() 函数对于原生的数据类型没什么问题，比如由字符串组成的列表。但是它 用不了自定义类型，比如我们将在下面定义的 Customer 对象。让我们对它稍作修改，让它 可以发现列表是由 Customer 对象组成的，这样就可以对应地对其进行显示了。下面是重新 定义的 displays() 函数:
			function displays(list) {
				for(list.front(); list.currpos() < list.length; list.next()) {
					if(list.getElement() instanceof Customs) {
						console.log(list.getElement()['name'] + ',' + list.getElement()['movie']); //用 name 和 movie 做索引,得到客户检出的相应条目的值
					} else {
						console.log(list.getElement());
					}
				}
			}
			var customers = new list();

			function Customer(name, movie) {
				this.name = name;
				this.movie = movie;
			}

			function checkout(name, movie, filmlist, customerlist) {
				if(movielist.contains(movie)) {
					var c = new Customer(name, movie);
					customerlist.append(c);
					filmlist.remove(movie);
				} else {
					console.log(movie + 'is not available');
				}
			}

			/*
			 
			 以用下列简单代码测试 checkOut() 函数:
			var movies = createArr("films.txt");
			var movieList = new List();
			var customers = new List();
			for (var i = 0; i < movies.length; ++i) {
			        movieList.append(movies[i]);
			     }
			     print("Available movies: \n");
			     displayList(movieList);
			     checkOut("Jane Doe", "The Godfather", movieList, customers);
			     print("\nCustomer Rentals: \n");
			     displayList(customers);
			
			 * */

			//标题
			var movies = createArr('flims.txt');
			var movieslist = new list();
			var custromers = new list();
			for(var i = 0; i < movies.length; ++i) {
				movielist.append(movies[i]);
			}
			console.log('available movies:\n');
			displays(movielist);
			putstr('\nEnter your name:');
			var name = readline();
			putstr('what movie would you like?');
			var movie = readline();
			checkout(name, movie, movielist, customers);
			console.log("\nCustomer Rentals: \n");
			displays(customers);
			console.log("\nMovies Now Available\n");
			displays(movielist)
		</script>
	</body>

</html>